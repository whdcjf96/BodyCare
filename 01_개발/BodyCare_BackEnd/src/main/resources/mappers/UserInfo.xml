<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="com.example.bodycare_backend.dao.UserInfoDao">
    <!--    TODO: 기본페이지 데이터 입력-->
    <!--    TODO: FK-->
    <insert id="insertUserBasic" parameterType="com.example.bodycare_backend.model.UserInfo">
        INSERT INTO USER_INFO(ID,
                              WEIGHT,
                              BODY_FAT,
                              MUSCLE_MASS,
                              CREATED_TIME)
        VALUES (#{id},
                #{weight},
                #{bodyFat},
                #{muscleMass},
                TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS'))
    </insert>
    <update id="updateUserAct" parameterType="com.example.bodycare_backend.model.UserInfo">
        UPDATE USER_INFO
        SET WEIGHT=#{weight},
            BODY_FAT=#{bodyFat},
            MUSCLE_MASS=#{muscleMass},
            UPDATE_TIME=TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS')
        WHERE USER_ID = #{userId}
    </update>

    <!--    TODO: 운동도우미에서 데이터 삽입-->
    <update id="updateUserExer" parameterType="com.example.bodycare_backend.model.UserInfo">
        UPDATE USER_INFO
        SET KCAL_START=#{kcalStart},
            WEIGHT_GOAL = #{weightGoal},
            KCAL_WEEKLY=#{kcalWeekly},
            UPDATE_TIME = TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS')
        WHERE USER_ID = #{userId}
    </update>

    <!--    TODO: 활동관리페이지/식단관리에서 활동대사량 계산을 위해 읽어오기-->
    <!--    TODO: FK  TB_USER테이블과 USER_ACTIVITY에서 값을 읽어와야 함-->
    <!--   TODO: 입력값 수정할거야...-->
    <select id="selectAct" parameterType="Long"
            resultType="com.example.bodycare_backend.model.UserInfo">
        SELECT C.USER_ID
             , A.HEIGHT
             , A.AGE
             , A.GENDER
             , C.WEIGHT
             , C.BODY_FAT
             , C.MUSCLE_MASS
             , SUM(D.INTENSITY * B.ACTIVITY_TIME)
        FROM TB_USER A,
             USER_ACTIVITY B,
             USER_INFO C,
             ACTIVITY D
        WHERE C.USER_ID(+) = A.ID
          AND C.USER_ID(+) = B.USER_ID
          AND B.ACTIVITY_ID = D.ID
          AND C.USER_ID = #{userId}
        group by C.USER_ID, A.HEIGHT, A.AGE, A.GENDER, C.WEIGHT,
                 C.BODY_FAT, C.MUSCLE_MASS;
    </select>

    <!--    TODO: 운동도우미에서 리드-->
    <!--    TODO: FK-->
    <select id="selectExer" parameterType="Long"
            resultType="com.example.bodycare_backend.model.UserInfo">
        SELECT USER_ID, WEIGHT, BODY_FAT
        FROM USER_INFO
        WHERE USER_ID = #{userId};
    </select>


</mapper>


